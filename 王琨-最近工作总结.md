## 1. 工作总结：

---

总结时间：2025/3/23-2025/4/27

### 排查bug：

* 刘金锁提出，范各庄，实时计算一直使用背景数据，实时参数改成全时过段时间又会自动变背景。
* 刘金锁提出，范各庄，提取图波形显示不正确。

排查经过：

上面两个问题都是同一个问题。从孙伟豪那里获取远程码，远程范各庄的电脑，试图复现现象。直接修改库表中保存全时/背景的参数字段，全改成全时，一段时间发现确实表中字段又变回了背景。通过在页面F12查看请求，发现前端的【同步】按钮调用接口修改实时参数表的时候，类型参数class_id没传，从而让实时表的class_id自动变为了默认值3，也就是背景。所以猜测是点击了【同步】按钮才会自动变回背景计算。后来，我在禅道bug提交平台，看到2022年测试提过随掘的一个bug，当时修改bug时，提出了同步不传class_id默认3，才导致了这个bug。

在该数据库时还发现实时和历史计算是从两张不同的表里取的参数，但历史参数表的参数改成全时或背景都不影响历史重算，反而是实时表的class_id在影响历史重算数据类型。通过跟踪后台代码，发现：实时计算前没有查表取参数，而是用的写死的变量默认值3。历史重算，查表获取class_id，查错了表到实时表而不是历史表。

上面这两个地方，经过修改后，在版本33提交了。

* 4月14号上午，郭金帅和郑艳反映矿上要修改用户名+密码为：jinchuanweizhen/JckyDiceke115113.@，密码修改失败，很紧急。

  排查经过：

  跟踪后台的登录代码，找到问题是密码验证时，@这个字符在原本的代码里没有解码的逻辑，并且即使解码后，使用某个常用的数据库查询函数会查不出来。

  后增加了解码逻辑，和使用原始的查询函数完成密码验证。

### 开发新特性：

* 孙伟豪提出，范各庄和潘三，偏移距处增加修改迎头通道功能。

  经过沟通理解原理的基础上，修改代码，并debug，协调郭金帅在范各庄和潘三矿上升级。后续孙伟豪反馈了小bug，改正。

* 预警的增加运维处理后再发送功能。

  数据库增加字段，开发后台功能，并同郭金帅沟通开了企业微信，进行了测试，运维和用户正常收到了预警信息。

* 预警重算功能。

  在整理预警逻辑的基础上，重构了预警的部分代码，使之能够更好的复用到预警重算功能。

  并为了解决前端反馈的因其测试环境预警阈值表为空导致的后台崩溃，以及更好的处理和反馈给前端异常信息，增加了一些异常处理且兼容之前代码，增加代码健壮性。

* 开发上传预警资料的接口。

  现已增加为上传资料接口。下载资料接口，目前暂支持：图片，pdf，csv，xlsx。

* 增加回采位置历史记录。

  建表，增加触发器，当回采位置修改时自动记录。

### 支持前端开发：

* 编写接口并测试：

  | 我写的或修改过的接口                | 功能                                                         | 用法                                              |
  | ----------------------------------- | ------------------------------------------------------------ | ------------------------------------------------- |
  | /upload_save_warningImg/:name       | 上传图片并入库                                               | name传图片名称，包括后缀名                        |
  | /upload_doc/:mime/:name             | 文件上传：图片，pdf，xlsx，csv                               | mime传后缀名，name传文件名包括后缀名              |
  | /download_doc/:mime/:name           | 下载文件：图片，pdf，xlsx，csv                               |                                                   |
  | /configFilePath                     | 获取当前使用的配置文件路径                                   |                                                   |
  | /firstChnNO                         | 获取基准通道号                                               |                                                   |
  | /devices                            | 获取配置文件中devices字段信息                                |                                                   |
  | /update_devices/:jsonName           | 修改配置文件中devices字段信息                                | jsonName传配置文件名，包括etc/                    |
  | /semt                               | 用户登录                                                     |                                                   |
  | /nopswd                             |                                                              |                                                   |
  | /warning_recalc/:from_time/:to_time | 预警历史重算：e_warning_info表删除指定时间段内已有预警信息，从e_msevt_rslts中重新筛选记录经过计算入库。 |                                                   |
  | /table/:tblName/:delCondition?      |                                                              | 我增加了：function类型，用于传SQL函数作为插入值。 |

* 前端反馈：预警表`e_warning_info`有记录，但前端处理页面不显示。

  排查后，发现表`e_warning_inf`o的`suggestion`字段在建表时，写的是`DEFAULT NULL`，于是表中记录该字段值为`NULL`。而前端在使用通用接口查询该表时，接口中逻辑不允许有字段值为`NULL`，导致查不出结果。

* 一些日常的前端反馈的接口用法，或建表需求帮助检查sql语句是否正确若有错改正。

### 整理系统文档

整理目前我在改bug和支持前端工作中接触到的系统各个部分，如表功能，接口功能，模块功能和实现。

## 2. 目前还未做的工作及后续安排

---

### TODO

* 孙伟豪反馈的潘三数据显示问题。
* 排查提取图是否默认进行了道间均衡。
* 测试在禅道提的4个bug。

### 后续安排

经过这段时间的工作和思考。对于后续的工作，我会首先明确任务的优先级，合理安排时间，优先解决紧急的问题。在此基础上开发安排的新需求、修改bug、支持前端。

上上周因为范各庄提出的问题有点多，而问题有些是历史原因，排查起来花了较多时间。上周，主要是高鑫宇在做统筹这块的工作，我很佩服他的对于业务的熟练以及统筹的能力。后面的时间，我会尽快在工作中掌握系统的细节和历史安排，做到可以又好又快的兼顾工程部提出的bug和其他开发。同时我也真诚的期盼，在我可以做到这些之前，可以通过完善工作流程和部门间沟通步骤，尽量让工作内容和目标更加清晰明确，能够交出满意的作品。