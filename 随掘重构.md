* 模型参数表除了总掘进里程和参考点之外还需要哪些字段
* 掘进班次相关的放到模型参数，还是建新的表
* 为了减小对过去已有代码影响，逐步将代码中用到原表的地方进行替换。且`e_tunnel_locinfo`中字段太少，考虑建新表`e_tunnel1_status`



# 1. 表名前缀

`e_tunnel1_`

# 2. 库表与概念

## 掘进面空间



## 掘进概况

```cpp
mining_locx_total //总掘进里程(工作面长度？)
mining_locx_start //起始掘进里程
mining_dir	//掘进方向
start_time 	//班次1开始时间
end_time  	//班次1结束时间
start_time 	//班次2开始时间
end_time  	//班次2结束时间
is_mining 	//是否正在掘进（状态）
```

## 日掘进状态

| 表格                  | 说明                                                         |
| --------------------- | ------------------------------------------------------------ |
| e_tunnel1_status      | 掘进里程变更时间戳，掘进里程，偏移距，日进尺，基准通道等状态的【最新和历史】 |
|                       |                                                              |
|                       |                                                              |
| e_chns_config         | 通道实时坐标                                                 |
| e_chns_config_history | 通道历史坐标                                                 |
| e_tunnel1_modelParm   | 掘进模型参数表：掘进方向                                     |
|                       |                                                              |

e_tunnel_cur_status，e_mining_PCOLocParm，e_tunnel_locinfo，e_mining_locx_history可合并成新表`e_tunnel1_status`。

暂时先不建表e_tunnel1_status，以后再逐步迭代舍弃旧表，建立新表。

* 为了减小对过去已有代码影响，逐步将代码中用到原表的地方进行替换，建新表`e_tunnel1_status`保存【日掘进状态】，包含下列字段：

  ```cpp
  mining_date	//更新截止时间戳（主键）
  mining_locx	//掘进里程
  heading_mil	//偏移距
  day_step		//平均日进尺
  firstChnNO	//基准通道
      
  forward_distance //mining_locx - 100？（要不要？）mining_locx + mark_XLen？
  back_distance //mining_locx + 50
  ```

* 表`e_tunnel_cur_status`舍弃，其中字段：

  `mining_locx`，`heading_mil`，`firstChnNO`，`forward_distance`，`back_distance`

  表`e_mining_PCOLocParm`中字段：

  `mining_locx`，`mining_dir`，`day_step`

  保存历史也保存最新。手动修改掘进里程/偏移距/日进尺等参数，自动计算掘进里程，都入库表`e_tunnel1_status`。

* **表`e_mining_PCOLocParm`中字段`mark_XLen`，`dXGrdLen`，`dYGrdLen`，`dZGrdLen`需保留？不用字段`mining_locx`，`mining_dir`，`day_step`，`mining_date`？**

## （2）观测系统

e_chns_config_tunnel舍弃，使用e_chns_config_history

微震通道坐标改为从`e_chns_config_history`中取

## （3）掘进模型参数表（用户输入）e_space

`e_tunnel1_modelParm`

```cpp

forecast_forward_distance//前方预测范围
//观测系统信息
//通道间距（通道间距不同）
//偏移距的阈值范围（页面提示）
```



# 3. 原有代码影响（修改）

| 废弃表                |      |
| --------------------- | ---- |
| e_tunnel_cur_status   |      |
| e_mining_PCOLocParm   |      |
| e_tunnel_locinfo      |      |
| e_mining_locx_history |      |
| e_chns_config_tunnel  |      |
|                       |      |
|                       |      |
|                       |      |

## （1）e_tunnel_cur_status

* updateTunnelModelInfo()，可替换：e_tunnel1_status
* updateTunnelCurStatus()，可替换：e_tunnel1_status
* initTunnelCurStatus()，待定：读表初始化了`hzi::feed`等参数
* getWarningInfo()，可替换：e_tunnel1_status

## （2）e_mining_PCOLocParm

* updateTunnelModelInfo()，可替换：e_tunnel1_status
* **updateTunnelCurStatus()，待定：读`mark_XLen`**
* **getminingLoc()，待定：这个函数随掘随采？**
* changeChnsLoc()，可替换：
* setPCOLocParm()，待定：读`mark_XLen`等参数
* 接口，/cmds/empty_data
* 接口，/samp_conf/:tblName/:itmNames/:fromInit?
* 接口，/getLocInfo/:timestamp/:cols，可替换：e_tunnel1_status

## （3）e_tunnel_locinfo

* insertTunnelLocInfo()，可替换：e_tunnel1_status
* updateTunnelModelInfo()，可删除
* 接口，/getLocInfo/:timestamp/:cols，可删除
* 接口，/handerTunnelSignal/:start_loc/:end_loc/:time_len，可替换：e_tunnel1_status
* setPCOLocParm()，可删除

## （4）e_mining_locx_history

* updateTunnelCurStatus()，可删除

## （5）e_chns_config_tunnel

* updateChanelsLoc()，可删除，直接更新到`e_chns_config`
* initTunnelCurStatus()，可删除
* getChnLoc_history()，可删除
* handleScanSpeed()，可替换：e_tunnel1_status



## 敲定

暂时先不建表e_tunnel1_status，以后再逐步迭代舍弃旧表，建立新表。

* e_chns_config_tunnel不用，改为e_chns_config_history

* e_tunnel_locinfo和pco参数表保留，e_cur_status保留但更新与否都行

* e_tunnel_locinfo和pco参数表中回采位置，偏移距，日进尺都更新。前端从e_tunnel_locinfo中拿历史，pco需要我更新一下。

* 坐标从e_chns_config和history中取，前端计算后直接写入e_chns_config。